<!DOCTYPE html>
<html lang="en">

<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">

  <script>

    //Handles our FETCH response. This function is async because it
    //contains an await.
    const handleResponse = async (response) => {
      let characters = await response.json();
      let content = document.querySelector("#content");

      
      //This functionality generates the different rows and columns that will display all the different characters.
      //I have to check up on the bulma functionality since it doesn't work to the way i want it to
      let rowCount = 1;
      let colCount = 1;
      for (const key in characters) {
        const characterStats = characters[key];

        if (!document.querySelector(`#row${rowCount}`)) {
          content.innerHTML += `
          <div id = "row${rowCount}" class = "row tile"></div>          
          `
        }

        let currentRow = document.querySelector(`#row${rowCount}`);
        let nameWithoutSpaces = characterStats.name.split(" ").join("");

        let characterDOM = document.createElement("div");
        characterDOM.setAttribute("class", "tile character");
        characterDOM.setAttribute("id", nameWithoutSpaces);
        characterDOM.innerHTML += `
        <p>${characterStats.name}</p>
        `;
        let expandStatButton = document.createElement("button");

        //There will also be an expand stats button that will show the user all the stats of the character selected
        expandStatButton.textContent = "Click to see stats";
        expandStatButton.onclick = () => {
          characterDOM.innerHTML += `
            <div class = "stats">
            <p class = "statText">Temper: ${characterStats.temper}</p>
            <p class = "statText">Morality: ${characterStats.morality}</p>
            <p class = "statText">Intelligence: ${characterStats.intelligence}</p>
            <p class = "statText">Emotional: ${characterStats.emotional}</p>
            </div>
            `;
        };

        characterDOM.appendChild(expandStatButton);
        currentRow.appendChild(characterDOM);

        colCount++;
        if (colCount > 5) {
          colCount = 0;
          rowCount++;
        }
      };


      //This is the local storage functionallity. Needs to be polished.
      if (localStorage.getItem("personalityMatches")) {
        let personalityString = localStorage.getItem("personalityMatches");
        let personalityArray = JSON.parse(personalityString);
        for (let character of personalityArray) {
          let convertedId = character.split(" ").join("");
          if (document.querySelector(`#${convertedId}`)) {
            let characterDOM = document.querySelector(`#${convertedId}`);
            characterDOM.style.opacity = "100%";
            characterDOM.style.color = "green";
          }
        }
      }
    }
    const sendFetch = async (url, acceptedType) => {
      const options = {
        method: 'GET',
        headers: { 'Accept': acceptedType },
      }
      let response = await fetch(url, options);

      handleResponse(response);
    };


    //Init function is called when window.onload runs (set below).
    const init = () => { sendFetch("/getCharacters", "application/json"); };
    //When the window loads, run init.
    window.onload = init;
  </script>
</head>

<body>
  <section id="top">
    <h1>Welcome the Character Personality Quiz!</h1>
    <h3>Which character is literally you?</h3>
  </section>
  <section id="content" class="row tile">
    <button id="moveToQuiz"><a href="quiz.html">Start the quiz!</a></button>
    <div id="row1" class="row tile"></div>
    <div id="row2" class="row tile"></div>
    <div id="row3" class="row tile"></div>
    <div id="row4" class="row tile"></div>
  </section>
</body>

</html>
