<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Sheet</title>
</head>
<script>

    const handleResponse = async (response) => {
        let questionsJSON = await response.json();
        let radioForm = document.querySelector("#questions");

        let count = 1;
        for (let x in questionsJSON.questions) {
            let value = questionsJSON.questions[x]
            const newQuestionDOM = document.createElement("div");
            newQuestionDOM.setAttribute("class", `${value.questionType} question`);
            newQuestionDOM.innerHTML = `
            <p>${value.text}</p>
            <input type="radio" id = "${value.questionType}${count}-low"  name="${value.questionType}${count}" value="1">
                <label for = "${value.questionType}${count}-low">${value.options.low}</label><br>
            <input type="radio" id = "${value.questionType}${count}-medium" name="${value.questionType}${count}" value="2">
                <label for = "${value.questionType}${count}-medium">${value.options.medium}</label><br>
            <input type="radio" id = "${value.questionType}${count}-high" name="${value.questionType}${count}" value="3">
                <label for = "${value.questionType}${count}-high">${value.options.high}</label><br>
            `;
            radioForm.appendChild(newQuestionDOM);
            count++;
            if (count > 5) {
                count = 1;
            }
        }
        const submit = () => {
            const tallyAnswers = (questionType) => {
                let sum = 0;
                for (let i = 1; i < 6; i++) {
                    let name = questionType + i;
                    sum += parseInt(document.querySelector(`input[name=${name}]:checked`).value);
                }
                return sum;
            }

            let userAnswerData = [];
            userAnswerData.push(tallyAnswers("temper"));
            userAnswerData.push(tallyAnswers("morality"));
            userAnswerData.push(tallyAnswers("intelligence"));
            userAnswerData.push(tallyAnswers("emotional"));

            console.log(userAnswerData);
        }



        let submitButton = document.createElement("input");
        submitButton.setAttribute("type", "submit");
        submitButton.setAttribute("value", "submit");
        submitButton.textContent = "Submit your answers";
        submitButton.addEventListener('click', submit);
        radioForm.appendChild(submitButton);



    };

    const sendFetch = async (url, acceptedType) => {
        const options = {
            method: 'GET',
            headers: { 'Accept': acceptedType },
        }
        let response = await fetch(url, options);

        handleResponse(response);
    };


    //Init function is called when window.onload runs (set below).
    const init = () => {
        //first thing we do is get the json by calling it from the server
        sendFetch("/questionsJSON", "application/json");
    };

    //When the window loads, run init.
    window.onload = init;
</script>

<body>
    <form action="/sendAnswers" id="questions">
    </form>
</body>

</html>
